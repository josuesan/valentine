<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Generator - Valentine</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #FFF5F5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem;
    }
    h1 {
      color: #E91E63;
      margin-bottom: 0.5rem;
      font-size: 1.5rem;
    }
    p {
      color: #666;
      margin-bottom: 2rem;
      font-size: 0.9rem;
    }
    #qr-container {
      background: white;
      border-radius: 24px;
      padding: 2rem;
      box-shadow: 0 8px 40px rgba(233, 30, 99, 0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }
    #qr-canvas { border-radius: 12px; }
    .btn {
      background: #E91E63;
      color: white;
      border: none;
      padding: 14px 32px;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover { background: #C2185B; }
    .url-text {
      font-size: 0.8rem;
      color: #999;
      word-break: break-all;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>QR Code - Valentine</h1>
  <p>Escanea para abrir tu sorpresa</p>
  <div id="qr-container">
    <canvas id="qr-canvas"></canvas>
    <p class="url-text">https://josuesan.github.io/valentine/</p>
    <button class="btn" onclick="downloadQR()">Descargar QR</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
  <script>
    var URL = 'https://josuesan.github.io/valentine/';
    var CELL_SIZE = 8;
    var MARGIN = 40;
    var CORNER_RADIUS = 4;

    // Colors
    var BG_COLOR = '#FFFFFF';
    var MODULE_COLOR_CENTER = '#E91E63';   // rosa profundo
    var MODULE_COLOR_EDGE   = '#880E4F';   // burgundy
    var FINDER_COLOR        = '#E91E63';
    var HEART_COLOR         = '#FF4081';

    // Generate QR data
    var qr = qrcode(0, 'M');
    qr.addData(URL);
    qr.make();
    var moduleCount = qr.getModuleCount();

    var size = moduleCount * CELL_SIZE + MARGIN * 2;
    var canvas = document.getElementById('qr-canvas');
    canvas.width = size * 2;   // retina
    canvas.height = size * 2;
    canvas.style.width = size + 'px';
    canvas.style.height = size + 'px';
    var ctx = canvas.getContext('2d');
    ctx.scale(2, 2);

    // Background
    ctx.fillStyle = BG_COLOR;
    roundRect(ctx, 0, 0, size, size, 16);
    ctx.fill();

    // Subtle radial glow behind QR
    var grad = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size * 0.45);
    grad.addColorStop(0, 'rgba(248,187,208,0.25)');
    grad.addColorStop(1, 'rgba(248,187,208,0)');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, size, size);

    // Determine finder pattern positions (top-left, top-right, bottom-left)
    var finderSize = 7;

    function isFinderArea(r, c) {
      // top-left
      if (r < finderSize + 1 && c < finderSize + 1) return true;
      // top-right
      if (r < finderSize + 1 && c >= moduleCount - finderSize - 1) return true;
      // bottom-left
      if (r >= moduleCount - finderSize - 1 && c < finderSize + 1) return true;
      return false;
    }

    // Heart area in center
    var heartRadius = 3.5;
    var cx = moduleCount / 2;
    var cy = moduleCount / 2;

    function isHeartArea(r, c) {
      var dx = (c + 0.5 - cx) / heartRadius;
      var dy = (r + 0.5 - cy) / heartRadius;
      // Heart shape equation
      var v = dx * dx + Math.pow(dy - 0.4 * Math.sqrt(Math.abs(dx)), 2);
      return v < 1.1;
    }

    // Draw regular modules (not finder, not heart area)
    for (var r = 0; r < moduleCount; r++) {
      for (var c = 0; c < moduleCount; c++) {
        if (!qr.isDark(r, c)) continue;
        if (isFinderArea(r, c)) continue;
        if (isHeartArea(r, c)) continue;

        var x = MARGIN + c * CELL_SIZE;
        var y = MARGIN + r * CELL_SIZE;

        // Gradient from center
        var dist = Math.sqrt(Math.pow(r - moduleCount/2, 2) + Math.pow(c - moduleCount/2, 2));
        var maxDist = Math.sqrt(2) * moduleCount / 2;
        var t = dist / maxDist;

        ctx.fillStyle = lerpColor(MODULE_COLOR_CENTER, MODULE_COLOR_EDGE, t);
        roundRect(ctx, x + 0.5, y + 0.5, CELL_SIZE - 1, CELL_SIZE - 1, CORNER_RADIUS);
        ctx.fill();
      }
    }

    // Draw finder patterns (rounded, styled)
    drawFinder(0, 0);
    drawFinder(0, moduleCount - finderSize);
    drawFinder(moduleCount - finderSize, 0);

    function drawFinder(startR, startC) {
      var x = MARGIN + startC * CELL_SIZE;
      var y = MARGIN + startR * CELL_SIZE;
      var s = finderSize * CELL_SIZE;

      // Outer ring
      ctx.strokeStyle = FINDER_COLOR;
      ctx.lineWidth = CELL_SIZE;
      roundRect(ctx, x + CELL_SIZE/2, y + CELL_SIZE/2, s - CELL_SIZE, s - CELL_SIZE, CELL_SIZE * 1.5);
      ctx.stroke();

      // Inner square
      ctx.fillStyle = FINDER_COLOR;
      var innerOffset = CELL_SIZE * 2;
      var innerSize = s - CELL_SIZE * 4;
      roundRect(ctx, x + innerOffset, y + innerOffset, innerSize, innerSize, CELL_SIZE);
      ctx.fill();
    }

    // Draw heart in center
    drawHeart(size / 2, size / 2 - 2, 22, HEART_COLOR);

    function drawHeart(cx, cy, s, color) {
      ctx.save();
      ctx.fillStyle = color;
      ctx.beginPath();
      // Heart bezier path
      var topY = cy - s * 0.4;
      ctx.moveTo(cx, cy + s * 0.55);
      // Left curve
      ctx.bezierCurveTo(cx - s * 0.02, cy + s * 0.4, cx - s * 0.55, cy + s * 0.1, cx - s * 0.55, topY);
      ctx.bezierCurveTo(cx - s * 0.55, topY - s * 0.35, cx - s * 0.15, topY - s * 0.4, cx, topY + s * 0.05);
      // Right curve
      ctx.bezierCurveTo(cx + s * 0.15, topY - s * 0.4, cx + s * 0.55, topY - s * 0.35, cx + s * 0.55, topY);
      ctx.bezierCurveTo(cx + s * 0.55, cy + s * 0.1, cx + s * 0.02, cy + s * 0.4, cx, cy + s * 0.55);
      ctx.closePath();
      ctx.fill();

      // White outline for visibility
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.restore();
    }

    // Utility: rounded rect
    function roundRect(ctx, x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.lineTo(x + w - r, y);
      ctx.quadraticCurveTo(x + w, y, x + w, y + r);
      ctx.lineTo(x + w, y + h - r);
      ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
      ctx.lineTo(x + r, y + h);
      ctx.quadraticCurveTo(x, y + h, x, y + h - r);
      ctx.lineTo(x, y + r);
      ctx.quadraticCurveTo(x, y, x + r, y);
      ctx.closePath();
    }

    // Utility: lerp between two hex colors
    function lerpColor(a, b, t) {
      var ar = parseInt(a.slice(1,3), 16), ag = parseInt(a.slice(3,5), 16), ab = parseInt(a.slice(5,7), 16);
      var br = parseInt(b.slice(1,3), 16), bg = parseInt(b.slice(3,5), 16), bb = parseInt(b.slice(5,7), 16);
      var rr = Math.round(ar + (br - ar) * t);
      var rg = Math.round(ag + (bg - ag) * t);
      var rb = Math.round(ab + (bb - ab) * t);
      return '#' + ((1 << 24) + (rr << 16) + (rg << 8) + rb).toString(16).slice(1);
    }

    // Download
    function downloadQR() {
      // Create a higher-res version for print
      var printScale = 4;
      var printCanvas = document.createElement('canvas');
      printCanvas.width = size * printScale;
      printCanvas.height = size * printScale;
      var pctx = printCanvas.getContext('2d');
      pctx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, printCanvas.width, printCanvas.height);

      var link = document.createElement('a');
      link.download = 'valentine-qr.png';
      link.href = printCanvas.toDataURL('image/png');
      link.click();
    }
  </script>
</body>
</html>
